7a1b7a19fd2f0ddfd1c5f68542c292de
"use strict";
/**
 * Tests des mocks pour les dépendances externes
 */
Object.defineProperty(exports, "__esModule", { value: true });
const fs_mock_1 = require("./mocks/fs-mock");
const octokit_mock_1 = require("./mocks/octokit-mock");
const env_mock_1 = require("./mocks/env-mock");
describe('Mocks pour les dépendances externes', () => {
    describe('mockFs - Mock du système de fichiers', () => {
        it('devrait permettre de mocker les opérations sur les fichiers', () => {
            // Création du mock
            const { fs: fsMock, restore } = (0, fs_mock_1.mockFs)();
            // Test des méthodes mockées
            expect(fsMock.existsSync('test.txt')).toBe(false);
            expect(fsMock.existsSync).toHaveBeenCalledWith('test.txt');
            // Restauration des fonctions originales
            restore();
        });
        it('devrait permettre de créer un système de fichiers virtuel', () => {
            const initialFiles = {
                '/test.txt': 'Contenu du fichier test',
                '/config.json': '{ "key": "value" }'
            };
            const { fs: fsMock, restore, getVirtualFs } = (0, fs_mock_1.mockVirtualFs)(initialFiles);
            // Vérification de l'existence des fichiers
            expect(fsMock.existsSync('/test.txt')).toBe(true);
            expect(fsMock.existsSync('/config.json')).toBe(true);
            expect(fsMock.existsSync('/non-existant.txt')).toBe(false);
            // Lecture d'un fichier
            expect(fsMock.readFileSync('/test.txt', 'utf8')).toBe('Contenu du fichier test');
            // Écriture dans un fichier
            fsMock.writeFileSync('/new-file.txt', 'Nouveau contenu');
            expect(fsMock.existsSync('/new-file.txt')).toBe(true);
            expect(fsMock.readFileSync('/new-file.txt', 'utf8')).toBe('Nouveau contenu');
            // Suppression d'un fichier
            fsMock.rmSync('/test.txt');
            expect(fsMock.existsSync('/test.txt')).toBe(false);
            // Vérification du système de fichiers virtuel
            const virtualFs = getVirtualFs();
            expect(virtualFs['/config.json']).toBe('{ "key": "value" }');
            expect(virtualFs['/new-file.txt']).toBe('Nouveau contenu');
            expect(virtualFs['/test.txt']).toBeUndefined();
            // Restauration des fonctions originales
            restore();
        });
    });
    describe('mockOctokit - Mock de l\'API GitHub', () => {
        it('devrait permettre de mocker les appels à l\'API GitHub', async () => {
            const octokit = (0, octokit_mock_1.mockOctokit)();
            // Test d'une méthode mockée
            const repoResponse = await octokit.rest.repos.get({
                owner: 'test-owner',
                repo: 'test-repo'
            });
            expect(repoResponse.data.name).toBe('test-repo');
            expect(repoResponse.data.owner.login).toBe('test-owner');
            // Test de la méthode issues.listForRepo
            const issuesResponse = await octokit.rest.issues.listForRepo({
                owner: 'test-owner',
                repo: 'test-repo'
            });
            expect(Array.isArray(issuesResponse.data)).toBe(true);
            expect(issuesResponse.data.length).toBe(5); // Valeur par défaut
        });
        it('devrait permettre de mocker le client GitHub', async () => {
            const client = (0, octokit_mock_1.mockGitHubClient)();
            // Test des méthodes mockées
            const repo = await client.getRepository();
            expect(repo.name).toBe('test-repo');
            const issues = await client.listIssues();
            expect(Array.isArray(issues)).toBe(true);
            const issue = await client.getIssue(123);
            expect(issue.number).toBe(123);
            expect(issue.title).toBe('Issue 123');
        });
    });
    describe('mockEnv - Mock des variables d\'environnement', () => {
        it('devrait permettre de mocker les variables d\'environnement', () => {
            const originalNodeEnv = process.env.NODE_ENV;
            // Création du mock
            const restore = (0, env_mock_1.mockEnv)({
                vars: {
                    NODE_ENV: 'test',
                    TEST_VAR: 'test-value'
                },
                unset: ['HOME']
            });
            // Vérification des variables
            expect(process.env.NODE_ENV).toBe('test');
            expect(process.env.TEST_VAR).toBe('test-value');
            expect(process.env.HOME).toBeUndefined();
            // Restauration des variables originales
            restore();
            // Vérification de la restauration
            expect(process.env.NODE_ENV).toBe(originalNodeEnv);
            expect(process.env.TEST_VAR).toBeUndefined();
        });
        it('devrait fournir des mocks prédéfinis pour GitHub', () => {
            const restore = (0, env_mock_1.mockGitHubEnv)();
            expect(process.env.GITHUB_TOKEN).toBe('mock-github-token-for-tests');
            expect(process.env.GITHUB_API_URL).toBe('https://api.github.com');
            expect(process.env.GITHUB_REPOSITORY).toBe('test-owner/test-repo');
            restore();
        });
        it('devrait fournir des mocks prédéfinis pour l\'environnement CI', () => {
            const restore = (0, env_mock_1.mockCIEnv)();
            expect(process.env.CI).toBe('true');
            expect(process.env.GITHUB_ACTIONS).toBe('true');
            expect(process.env.GITHUB_TOKEN).toBe('mock-github-token-for-ci');
            restore();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3N0ZXBoYW5lc291cm9uL2Rldi9iZWRkeS1ieWUtc3Rvcmllcy9naHAtY29ubmVjdG9yL3NyYy9saWIvdGVzdC1oZWxwZXJzL21vY2tzLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILDZDQUF3RDtBQUN4RCx1REFBcUU7QUFDckUsK0NBQXFFO0FBRXJFLFFBQVEsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7SUFDbkQsUUFBUSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtRQUNwRCxFQUFFLENBQUMsNkRBQTZELEVBQUUsR0FBRyxFQUFFO1lBQ3JFLG1CQUFtQjtZQUNuQixNQUFNLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztZQUV6Qyw0QkFBNEI7WUFDNUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUzRCx3Q0FBd0M7WUFDeEMsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyREFBMkQsRUFBRSxHQUFHLEVBQUU7WUFDbkUsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLFdBQVcsRUFBRSx5QkFBeUI7Z0JBQ3RDLGNBQWMsRUFBRSxvQkFBb0I7YUFDckMsQ0FBQztZQUVGLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsR0FBRyxJQUFBLHVCQUFhLEVBQUMsWUFBWSxDQUFDLENBQUM7WUFFMUUsMkNBQTJDO1lBQzNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xELE1BQU0sQ0FBQyxN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TUFBTSxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFFbEUsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3N0ZXBoYW5lc291cm9uL2Rldi9iZWRkeS1ieWUtc3Rvcmllcy9naHAtY29ubmVjdG9yL3NyYy9saWIvdGVzdC1oZWxwZXJzL21vY2tzLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0cyBkZXMgbW9ja3MgcG91ciBsZXMgZMOpcGVuZGFuY2VzIGV4dGVybmVzXG4gKi9cblxuaW1wb3J0IHsgbW9ja0ZzLCBtb2NrVmlydHVhbEZzIH0gZnJvbSAnLi9tb2Nrcy9mcy1tb2NrJztcbmltcG9ydCB7IG1vY2tPY3Rva2l0LCBtb2NrR2l0SHViQ2xpZW50IH0gZnJvbSAnLi9tb2Nrcy9vY3Rva2l0LW1vY2snO1xuaW1wb3J0IHsgbW9ja0VudiwgbW9ja0dpdEh1YkVudiwgbW9ja0NJRW52IH0gZnJvbSAnLi9tb2Nrcy9lbnYtbW9jayc7XG5cbmRlc2NyaWJlKCdNb2NrcyBwb3VyIGxlcyBkw6lwZW5kYW5jZXMgZXh0ZXJuZXMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdtb2NrRnMgLSBNb2NrIGR1IHN5c3TDqG1lIGRlIGZpY2hpZXJzJywgKCkgPT4ge1xuICAgIGl0KCdkZXZyYWl0IHBlcm1ldHRyZSBkZSBtb2NrZXIgbGVzIG9ww6lyYXRpb25zIHN1ciBsZXMgZmljaGllcnMnLCAoKSA9PiB7XG4gICAgICAvLyBDcsOpYXRpb24gZHUgbW9ja1xuICAgICAgY29uc3QgeyBmczogZnNNb2NrLCByZXN0b3JlIH0gPSBtb2NrRnMoKTtcbiAgICAgIFxuICAgICAgLy8gVGVzdCBkZXMgbcOpdGhvZGVzIG1vY2vDqWVzXG4gICAgICBleHBlY3QoZnNNb2NrLmV4aXN0c1N5bmMoJ3Rlc3QudHh0JykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGZzTW9jay5leGlzdHNTeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdC50eHQnKTtcbiAgICAgIFxuICAgICAgLy8gUmVzdGF1cmF0aW9uIGRlcyBmb25jdGlvbnMgb3JpZ2luYWxlc1xuICAgICAgcmVzdG9yZSgpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdkZXZyYWl0IHBlcm1ldHRyZSBkZSBjcsOpZXIgdW4gc3lzdMOobWUgZGUgZmljaGllcnMgdmlydHVlbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGluaXRpYWxGaWxlcyA9IHtcbiAgICAgICAgJy90ZXN0LnR4dCc6ICdDb250ZW51IGR1IGZpY2hpZXIgdGVzdCcsXG4gICAgICAgICcvY29uZmlnLmpzb24nOiAneyBcImtleVwiOiBcInZhbHVlXCIgfSdcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHsgZnM6IGZzTW9jaywgcmVzdG9yZSwgZ2V0VmlydHVhbEZzIH0gPSBtb2NrVmlydHVhbEZzKGluaXRpYWxGaWxlcyk7XG4gICAgICBcbiAgICAgIC8vIFbDqXJpZmljYXRpb24gZGUgbCdleGlzdGVuY2UgZGVzIGZpY2hpZXJzXG4gICAgICBleHBlY3QoZnNNb2NrLmV4aXN0c1N5bmMoJy90ZXN0LnR4dCcpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGZzTW9jay5leGlzdHNTeW5jKCcvY29uZmlnLmpzb24nKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChmc01vY2suZXhpc3RzU3luYygnL25vbi1leGlzdGFudC50eHQnKSkudG9CZShmYWxzZSk7XG4gICAgICBcbiAgICAgIC8vIExlY3R1cmUgZCd1biBmaWNoaWVyXG4gICAgICBleHBlY3QoZnNNb2NrLnJlYWRGaWxlU3luYygnL3Rlc3QudHh0JywgJ3V0ZjgnKSkudG9CZSgnQ29udGVudSBkdSBmaWNoaWVyIHRlc3QnKTtcbiAgICAgIFxuICAgICAgLy8gw4ljcml0dXJlIGRhbnMgdW4gZmljaGllclxuICAgICAgZnNNb2NrLndyaXRlRmlsZVN5bmMoJy9uZXctZmlsZS50eHQnLCAnTm91dmVhdSBjb250ZW51Jyk7XG4gICAgICBleHBlY3QoZnNNb2NrLmV4aXN0c1N5bmMoJy9uZXctZmlsZS50eHQnKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChmc01vY2sucmVhZEZpbGVTeW5jKCcvbmV3LWZpbGUudHh0JywgJ3V0ZjgnKSkudG9CZSgnTm91dmVhdSBjb250ZW51Jyk7XG4gICAgICBcbiAgICAgIC8vIFN1cHByZXNzaW9uIGQndW4gZmljaGllclxuICAgICAgZnNNb2NrLnJtU3luYygnL3Rlc3QudHh0Jyk7XG4gICAgICBleHBlY3QoZnNNb2NrLmV4aXN0c1N5bmMoJy90ZXN0LnR4dCcpKS50b0JlKGZhbHNlKTtcbiAgICAgIFxuICAgICAgLy8gVsOpcmlmaWNhdGlvbiBkdSBzeXN0w6htZSBkZSBmaWNoaWVycyB2aXJ0dWVsXG4gICAgICBjb25zdCB2aXJ0dWFsRnMgPSBnZXRWaXJ0dWFsRnMoKTtcbiAgICAgIGV4cGVjdCh2aXJ0dWFsRnNbJy9jb25maWcuanNvbiddKS50b0JlKCd7IFwia2V5XCI6IFwidmFsdWVcIiB9Jyk7XG4gICAgICBleHBlY3QodmlydHVhbEZzWycvbmV3LWZpbGUudHh0J10pLnRvQmUoJ05vdXZlYXUgY29udGVudScpO1xuICAgICAgZXhwZWN0KHZpcnR1YWxGc1snL3Rlc3QudHh0J10pLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIFxuICAgICAgLy8gUmVzdGF1cmF0aW9uIGRlcyBmb25jdGlvbnMgb3JpZ2luYWxlc1xuICAgICAgcmVzdG9yZSgpO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCdtb2NrT2N0b2tpdCAtIE1vY2sgZGUgbFxcJ0FQSSBHaXRIdWInLCAoKSA9PiB7XG4gICAgaXQoJ2RldnJhaXQgcGVybWV0dHJlIGRlIG1vY2tlciBsZXMgYXBwZWxzIMOgIGxcXCdBUEkgR2l0SHViJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb2N0b2tpdCA9IG1vY2tPY3Rva2l0KCk7XG4gICAgICBcbiAgICAgIC8vIFRlc3QgZCd1bmUgbcOpdGhvZGUgbW9ja8OpZVxuICAgICAgY29uc3QgcmVwb1Jlc3BvbnNlID0gYXdhaXQgb2N0b2tpdC5yZXN0LnJlcG9zLmdldCh7XG4gICAgICAgIG93bmVyOiAndGVzdC1vd25lcicsXG4gICAgICAgIHJlcG86ICd0ZXN0LXJlcG8nXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlcG9SZXNwb25zZS5kYXRhLm5hbWUpLnRvQmUoJ3Rlc3QtcmVwbycpO1xuICAgICAgZXhwZWN0KHJlcG9SZXNwb25zZS5kYXRhLm93bmVyLmxvZ2luKS50b0JlKCd0ZXN0LW93bmVyJyk7XG4gICAgICBcbiAgICAgIC8vIFRlc3QgZGUgbGEgbcOpdGhvZGUgaXNzdWVzLmxpc3RGb3JSZXBvXG4gICAgICBjb25zdCBpc3N1ZXNSZXNwb25zZSA9IGF3YWl0IG9jdG9raXQucmVzdC5pc3N1ZXMubGlzdEZvclJlcG8oe1xuICAgICAgICBvd25lcjogJ3Rlc3Qtb3duZXInLFxuICAgICAgICByZXBvOiAndGVzdC1yZXBvJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGlzc3Vlc1Jlc3BvbnNlLmRhdGEpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzc3Vlc1Jlc3BvbnNlLmRhdGEubGVuZ3RoKS50b0JlKDUpOyAvLyBWYWxldXIgcGFyIGTDqWZhdXRcbiAgICB9KTtcbiAgICBcbiAgICBpdCgnZGV2cmFpdCBwZXJtZXR0cmUgZGUgbW9ja2VyIGxlIGNsaWVudCBHaXRIdWInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbGllbnQgPSBtb2NrR2l0SHViQ2xpZW50KCk7XG4gICAgICBcbiAgICAgIC8vIFRlc3QgZGVzIG3DqXRob2RlcyBtb2Nrw6llc1xuICAgICAgY29uc3QgcmVwbyA9IGF3YWl0IGNsaWVudC5nZXRSZXBvc2l0b3J5KCk7XG4gICAgICBleHBlY3QocmVwby5uYW1lKS50b0JlKCd0ZXN0LXJlcG8nKTtcbiAgICAgIFxuICAgICAgY29uc3QgaXNzdWVzID0gYXdhaXQgY2xpZW50Lmxpc3RJc3N1ZXMoKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGlzc3VlcykpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGlzc3VlID0gYXdhaXQgY2xpZW50LmdldElzc3VlKDEyMyk7XG4gICAgICBleHBlY3QoaXNzdWUubnVtYmVyKS50b0JlKDEyMyk7XG4gICAgICBleHBlY3QoaXNzdWUudGl0bGUpLnRvQmUoJ0lzc3VlIDEyMycpO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCdtb2NrRW52IC0gTW9jayBkZXMgdmFyaWFibGVzIGRcXCdlbnZpcm9ubmVtZW50JywgKCkgPT4ge1xuICAgIGl0KCdkZXZyYWl0IHBlcm1ldHRyZSBkZSBtb2NrZXIgbGVzIHZhcmlhYmxlcyBkXFwnZW52aXJvbm5lbWVudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsTm9kZUVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WO1xuICAgICAgXG4gICAgICAvLyBDcsOpYXRpb24gZHUgbW9ja1xuICAgICAgY29uc3QgcmVzdG9yZSA9IG1vY2tFbnYoe1xuICAgICAgICB2YXJzOiB7XG4gICAgICAgICAgTk9ERV9FTlY6ICd0ZXN0JyxcbiAgICAgICAgICBURVNUX1ZBUjogJ3Rlc3QtdmFsdWUnXG4gICAgICAgIH0sXG4gICAgICAgIHVuc2V0OiBbJ0hPTUUnXVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFbDqXJpZmljYXRpb24gZGVzIHZhcmlhYmxlc1xuICAgICAgZXhwZWN0KHByb2Nlc3MuZW52Lk5PREVfRU5WKS50b0JlKCd0ZXN0Jyk7XG4gICAgICBleHBlY3QocHJvY2Vzcy5lbnYuVEVTVF9WQVIpLnRvQmUoJ3Rlc3QtdmFsdWUnKTtcbiAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5IT01FKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBcbiAgICAgIC8vIFJlc3RhdXJhdGlvbiBkZXMgdmFyaWFibGVzIG9yaWdpbmFsZXNcbiAgICAgIHJlc3RvcmUoKTtcbiAgICAgIFxuICAgICAgLy8gVsOpcmlmaWNhdGlvbiBkZSBsYSByZXN0YXVyYXRpb25cbiAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5OT0RFX0VOVikudG9CZShvcmlnaW5hbE5vZGVFbnYpO1xuICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LlRFU1RfVkFSKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ2RldnJhaXQgZm91cm5pciBkZXMgbW9ja3MgcHLDqWTDqWZpbmlzIHBvdXIgR2l0SHViJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdG9yZSA9IG1vY2tHaXRIdWJFbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LkdJVEhVQl9UT0tFTikudG9CZSgnbW9jay1naXRodWItdG9rZW4tZm9yLXRlc3RzJyk7XG4gICAgICBleHBlY3QocHJvY2Vzcy5lbnYuR0lUSFVCX0FQSV9VUkwpLnRvQmUoJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20nKTtcbiAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5HSVRIVUJfUkVQT1NJVE9SWSkudG9CZSgndGVzdC1vd25lci90ZXN0LXJlcG8nKTtcbiAgICAgIFxuICAgICAgcmVzdG9yZSgpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdkZXZyYWl0IGZvdXJuaXIgZGVzIG1vY2tzIHByw6lkw6lmaW5pcyBwb3VyIGxcXCdlbnZpcm9ubmVtZW50IENJJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdG9yZSA9IG1vY2tDSUVudigpO1xuICAgICAgXG4gICAgICBleHBlY3QocHJvY2Vzcy5lbnYuQ0kpLnRvQmUoJ3RydWUnKTtcbiAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5HSVRIVUJfQUNUSU9OUykudG9CZSgndHJ1ZScpO1xuICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LkdJVEhVQl9UT0tFTikudG9CZSgnbW9jay1naXRodWItdG9rZW4tZm9yLWNpJyk7XG4gICAgICBcbiAgICAgIHJlc3RvcmUoKTtcbiAgICB9KTtcbiAgfSk7XG59KTsgIl0sInZlcnNpb24iOjN9