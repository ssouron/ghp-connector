489516200ce4a491a9e1b82f91fe3cdb
"use strict";
/**
 * Mocks pour le système de fichiers (fs)
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockFs = mockFs;
exports.mockVirtualFs = mockVirtualFs;
const fs = __importStar(require("fs"));
/**
 * Crée un mock pour le module fs
 */
function mockFs() {
    // Sauvegarde des fonctions originales
    const original = {
        existsSync: fs.existsSync,
        readFileSync: fs.readFileSync,
        writeFileSync: fs.writeFileSync,
        mkdirSync: fs.mkdirSync,
        rmSync: fs.rmSync
    };
    // Création des mocks
    jest.spyOn(fs, 'existsSync').mockImplementation(() => false);
    jest.spyOn(fs, 'readFileSync').mockImplementation(() => Buffer.from(''));
    jest.spyOn(fs, 'writeFileSync').mockImplementation(() => undefined);
    jest.spyOn(fs, 'mkdirSync').mockImplementation(() => undefined);
    jest.spyOn(fs, 'rmSync').mockImplementation(() => undefined);
    // Fonction pour restaurer les fonctions originales
    const restore = () => {
        jest.spyOn(fs, 'existsSync').mockImplementation(original.existsSync);
        jest.spyOn(fs, 'readFileSync').mockImplementation(original.readFileSync);
        jest.spyOn(fs, 'writeFileSync').mockImplementation(original.writeFileSync);
        jest.spyOn(fs, 'mkdirSync').mockImplementation(original.mkdirSync);
        jest.spyOn(fs, 'rmSync').mockImplementation(original.rmSync);
    };
    return { fs, restore };
}
/**
 * Crée un système de fichiers virtuel pour les tests
 */
function mockVirtualFs(initialFiles = {}) {
    const virtualFs = { ...initialFiles };
    // Sauvegarde des fonctions originales
    const original = {
        existsSync: fs.existsSync,
        readFileSync: fs.readFileSync,
        writeFileSync: fs.writeFileSync,
        mkdirSync: fs.mkdirSync,
        rmSync: fs.rmSync
    };
    // Mock existsSync
    jest.spyOn(fs, 'existsSync').mockImplementation((path) => {
        const pathStr = path.toString();
        return pathStr in virtualFs;
    });
    // Mock readFileSync
    jest.spyOn(fs, 'readFileSync').mockImplementation((path, options) => {
        const pathStr = path.toString();
        if (!(pathStr in virtualFs)) {
            const error = new Error(`ENOENT: no such file or directory, open '${pathStr}'`);
            error.code = 'ENOENT';
            throw error;
        }
        const content = virtualFs[pathStr];
        const encoding = typeof options === 'string' ? options : options?.encoding;
        if (typeof content === 'string' && encoding === 'utf8') {
            return content;
        }
        return Buffer.isBuffer(content) ? content : Buffer.from(String(content));
    });
    // Mock writeFileSync
    jest.spyOn(fs, 'writeFileSync').mockImplementation((path, data) => {
        const pathStr = path.toString();
        // Conversion safe pour s'assurer que data est stockée correctement
        if (Buffer.isBuffer(data)) {
            virtualFs[pathStr] = data;
        }
        else if (typeof data === 'string') {
            virtualFs[pathStr] = data;
        }
        else {
            // Pour d'autres types ArrayBufferView
            try {
                virtualFs[pathStr] = Buffer.from(data);
            }
            catch (e) {
                // Fallback en cas d'erreur
                virtualFs[pathStr] = data.toString();
            }
        }
    });
    // Mock mkdirSync
    jest.spyOn(fs, 'mkdirSync').mockImplementation((path) => {
        const pathStr = path.toString();
        virtualFs[pathStr] = '';
        return pathStr;
    });
    // Mock rmSync
    jest.spyOn(fs, 'rmSync').mockImplementation((path) => {
        const pathStr = path.toString();
        if (pathStr in virtualFs) {
            delete virtualFs[pathStr];
        }
    });
    // Fonction pour restaurer les fonctions originales
    const restore = () => {
        jest.spyOn(fs, 'existsSync').mockImplementation(original.existsSync);
        jest.spyOn(fs, 'readFileSync').mockImplementation(original.readFileSync);
        jest.spyOn(fs, 'writeFileSync').mockImplementation(original.writeFileSync);
        jest.spyOn(fs, 'mkdirSync').mockImplementation(original.mkdirSync);
        jest.spyOn(fs, 'rmSync').mockImplementation(original.rmSync);
    };
    // Fonction pour accéder au système de fichiers virtuel
    const getVirtualFs = () => virtualFs;
    return { fs, restore, getVirtualFs };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3N0ZXBoYW5lc291cm9uL2Rldi9iZWRkeS1ieWUtc3Rvcmllcy9naHAtY29ubmVjdG9yL3NyYy9saWIvdGVzdC1oZWxwZXJzL21vY2tzL2ZzLW1vY2sudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWNILHdCQTJCQztBQUtELHNDQW9GQztBQWhJRCx1Q0FBeUI7QUFTekI7O0dBRUc7QUFDSCxTQUFnQixNQUFNO0lBQ3BCLHNDQUFzQztJQUN0QyxNQUFNLFFBQVEsR0FBRztRQUNmLFVBQVUsRUFBRSxFQUFFLENBQUMsVUFBVTtRQUN6QixZQUFZLEVBQUUsRUFBRSxDQUFDLFlBQVk7UUFDN0IsYUFBYSxFQUFFLEVBQUUsQ0FBQyxhQUFhO1FBQy9CLFNBQVMsRUFBRSxFQUFFLENBQUMsU0FBUztRQUN2QixNQUFNLEVBQUUsRUFBRSxDQUFDLE1BQU07S0FDbEIsQ0FBQztJQUVGLHFCQUFxQjtJQUNyQixJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3RCxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxjQUFjLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDekUsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsZUFBZSxDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDaEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUMsa0JBQWtCLENBQUMs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RTtRQUNuRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDaEMsSUFBSSxPQUFPLElBQUksU0FBUyxFQUFFLENBQUM7WUFDekIsT0FBTyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUIsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsbURBQW1EO0lBQ25ELE1BQU0sT0FBTyxHQUFHLEdBQUcsRUFBRTtRQUNuQixJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckUsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsY0FBYyxDQUFDLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3pFLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLGVBQWUsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUMzRSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxXQUFXLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkUsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9ELENBQUMsQ0FBQztJQUVGLHVEQUF1RDtJQUN2RCxNQUFNLFlBQVksR0FBRyxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUM7SUFFckMsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUM7QUFDdkMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvc3RlcGhhbmVzb3Vyb24vZGV2L2JlZGR5LWJ5ZS1zdG9yaWVzL2docC1jb25uZWN0b3Ivc3JjL2xpYi90ZXN0LWhlbHBlcnMvbW9ja3MvZnMtbW9jay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1vY2tzIHBvdXIgbGUgc3lzdMOobWUgZGUgZmljaGllcnMgKGZzKVxuICovXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxuLyoqXG4gKiBJbnRlcmZhY2UgcG91ciBsZSBzeXN0w6htZSBkZSBmaWNoaWVycyB2aXJ0dWVsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmlydHVhbEZpbGVTeXN0ZW0ge1xuICBbcGF0aDogc3RyaW5nXTogc3RyaW5nIHwgQnVmZmVyO1xufVxuXG4vKipcbiAqIENyw6llIHVuIG1vY2sgcG91ciBsZSBtb2R1bGUgZnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1vY2tGcygpIHtcbiAgLy8gU2F1dmVnYXJkZSBkZXMgZm9uY3Rpb25zIG9yaWdpbmFsZXNcbiAgY29uc3Qgb3JpZ2luYWwgPSB7XG4gICAgZXhpc3RzU3luYzogZnMuZXhpc3RzU3luYyxcbiAgICByZWFkRmlsZVN5bmM6IGZzLnJlYWRGaWxlU3luYyxcbiAgICB3cml0ZUZpbGVTeW5jOiBmcy53cml0ZUZpbGVTeW5jLFxuICAgIG1rZGlyU3luYzogZnMubWtkaXJTeW5jLFxuICAgIHJtU3luYzogZnMucm1TeW5jXG4gIH07XG5cbiAgLy8gQ3LDqWF0aW9uIGRlcyBtb2Nrc1xuICBqZXN0LnNweU9uKGZzLCAnZXhpc3RzU3luYycpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBmYWxzZSk7XG4gIGplc3Quc3B5T24oZnMsICdyZWFkRmlsZVN5bmMnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gQnVmZmVyLmZyb20oJycpKTtcbiAgamVzdC5zcHlPbihmcywgJ3dyaXRlRmlsZVN5bmMnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gdW5kZWZpbmVkKTtcbiAgamVzdC5zcHlPbihmcywgJ21rZGlyU3luYycpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB1bmRlZmluZWQpO1xuICBqZXN0LnNweU9uKGZzLCAncm1TeW5jJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHVuZGVmaW5lZCk7XG5cbiAgLy8gRm9uY3Rpb24gcG91ciByZXN0YXVyZXIgbGVzIGZvbmN0aW9ucyBvcmlnaW5hbGVzXG4gIGNvbnN0IHJlc3RvcmUgPSAoKSA9PiB7XG4gICAgamVzdC5zcHlPbihmcywgJ2V4aXN0c1N5bmMnKS5tb2NrSW1wbGVtZW50YXRpb24ob3JpZ2luYWwuZXhpc3RzU3luYyk7XG4gICAgamVzdC5zcHlPbihmcywgJ3JlYWRGaWxlU3luYycpLm1vY2tJbXBsZW1lbnRhdGlvbihvcmlnaW5hbC5yZWFkRmlsZVN5bmMpO1xuICAgIGplc3Quc3B5T24oZnMsICd3cml0ZUZpbGVTeW5jJykubW9ja0ltcGxlbWVudGF0aW9uKG9yaWdpbmFsLndyaXRlRmlsZVN5bmMpO1xuICAgIGplc3Quc3B5T24oZnMsICdta2RpclN5bmMnKS5tb2NrSW1wbGVtZW50YXRpb24ob3JpZ2luYWwubWtkaXJTeW5jKTtcbiAgICBqZXN0LnNweU9uKGZzLCAncm1TeW5jJykubW9ja0ltcGxlbWVudGF0aW9uKG9yaWdpbmFsLnJtU3luYyk7XG4gIH07XG5cbiAgcmV0dXJuIHsgZnMsIHJlc3RvcmUgfTtcbn1cblxuLyoqXG4gKiBDcsOpZSB1biBzeXN0w6htZSBkZSBmaWNoaWVycyB2aXJ0dWVsIHBvdXIgbGVzIHRlc3RzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtb2NrVmlydHVhbEZzKGluaXRpYWxGaWxlczogVmlydHVhbEZpbGVTeXN0ZW0gPSB7fSkge1xuICBjb25zdCB2aXJ0dWFsRnM6IFZpcnR1YWxGaWxlU3lzdGVtID0geyAuLi5pbml0aWFsRmlsZXMgfTtcbiAgXG4gIC8vIFNhdXZlZ2FyZGUgZGVzIGZvbmN0aW9ucyBvcmlnaW5hbGVzXG4gIGNvbnN0IG9yaWdpbmFsID0ge1xuICAgIGV4aXN0c1N5bmM6IGZzLmV4aXN0c1N5bmMsXG4gICAgcmVhZEZpbGVTeW5jOiBmcy5yZWFkRmlsZVN5bmMsXG4gICAgd3JpdGVGaWxlU3luYzogZnMud3JpdGVGaWxlU3luYyxcbiAgICBta2RpclN5bmM6IGZzLm1rZGlyU3luYyxcbiAgICBybVN5bmM6IGZzLnJtU3luY1xuICB9O1xuXG4gIC8vIE1vY2sgZXhpc3RzU3luY1xuICBqZXN0LnNweU9uKGZzLCAnZXhpc3RzU3luYycpLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aCkgPT4ge1xuICAgIGNvbnN0IHBhdGhTdHIgPSBwYXRoLnRvU3RyaW5nKCk7XG4gICAgcmV0dXJuIHBhdGhTdHIgaW4gdmlydHVhbEZzO1xuICB9KTtcblxuICAvLyBNb2NrIHJlYWRGaWxlU3luY1xuICBqZXN0LnNweU9uKGZzLCAncmVhZEZpbGVTeW5jJykubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoLCBvcHRpb25zKSA9PiB7XG4gICAgY29uc3QgcGF0aFN0ciA9IHBhdGgudG9TdHJpbmcoKTtcbiAgICBpZiAoIShwYXRoU3RyIGluIHZpcnR1YWxGcykpIHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKGBFTk9FTlQ6IG5vIHN1Y2ggZmlsZSBvciBkaXJlY3RvcnksIG9wZW4gJyR7cGF0aFN0cn0nYCkgYXMgTm9kZUpTLkVycm5vRXhjZXB0aW9uO1xuICAgICAgZXJyb3IuY29kZSA9ICdFTk9FTlQnO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGVudCA9IHZpcnR1YWxGc1twYXRoU3RyXTtcbiAgICBjb25zdCBlbmNvZGluZyA9IHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJyA/IG9wdGlvbnMgOiBvcHRpb25zPy5lbmNvZGluZztcbiAgICBcbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnICYmIGVuY29kaW5nID09PSAndXRmOCcpIHtcbiAgICAgIHJldHVybiBjb250ZW50O1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gQnVmZmVyLmlzQnVmZmVyKGNvbnRlbnQpID8gY29udGVudCA6IEJ1ZmZlci5mcm9tKFN0cmluZyhjb250ZW50KSk7XG4gIH0pO1xuXG4gIC8vIE1vY2sgd3JpdGVGaWxlU3luY1xuICBqZXN0LnNweU9uKGZzLCAnd3JpdGVGaWxlU3luYycpLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aCwgZGF0YSkgPT4ge1xuICAgIGNvbnN0IHBhdGhTdHIgPSBwYXRoLnRvU3RyaW5nKCk7XG4gICAgLy8gQ29udmVyc2lvbiBzYWZlIHBvdXIgcydhc3N1cmVyIHF1ZSBkYXRhIGVzdCBzdG9ja8OpZSBjb3JyZWN0ZW1lbnRcbiAgICBpZiAoQnVmZmVyLmlzQnVmZmVyKGRhdGEpKSB7XG4gICAgICB2aXJ0dWFsRnNbcGF0aFN0cl0gPSBkYXRhO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICB2aXJ0dWFsRnNbcGF0aFN0cl0gPSBkYXRhO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBQb3VyIGQnYXV0cmVzIHR5cGVzIEFycmF5QnVmZmVyVmlld1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmlydHVhbEZzW3BhdGhTdHJdID0gQnVmZmVyLmZyb20oZGF0YSBhcyBhbnkpOyAgXG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIEZhbGxiYWNrIGVuIGNhcyBkJ2VycmV1clxuICAgICAgICB2aXJ0dWFsRnNbcGF0aFN0cl0gPSBkYXRhLnRvU3RyaW5nKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvLyBNb2NrIG1rZGlyU3luY1xuICBqZXN0LnNweU9uKGZzLCAnbWtkaXJTeW5jJykubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoKSA9PiB7XG4gICAgY29uc3QgcGF0aFN0ciA9IHBhdGgudG9TdHJpbmcoKTtcbiAgICB2aXJ0dWFsRnNbcGF0aFN0cl0gPSAnJztcbiAgICByZXR1cm4gcGF0aFN0cjtcbiAgfSk7XG5cbiAgLy8gTW9jayBybVN5bmNcbiAgamVzdC5zcHlPbihmcywgJ3JtU3luYycpLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aCkgPT4ge1xuICAgIGNvbnN0IHBhdGhTdHIgPSBwYXRoLnRvU3RyaW5nKCk7XG4gICAgaWYgKHBhdGhTdHIgaW4gdmlydHVhbEZzKSB7XG4gICAgICBkZWxldGUgdmlydHVhbEZzW3BhdGhTdHJdO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gRm9uY3Rpb24gcG91ciByZXN0YXVyZXIgbGVzIGZvbmN0aW9ucyBvcmlnaW5hbGVzXG4gIGNvbnN0IHJlc3RvcmUgPSAoKSA9PiB7XG4gICAgamVzdC5zcHlPbihmcywgJ2V4aXN0c1N5bmMnKS5tb2NrSW1wbGVtZW50YXRpb24ob3JpZ2luYWwuZXhpc3RzU3luYyk7XG4gICAgamVzdC5zcHlPbihmcywgJ3JlYWRGaWxlU3luYycpLm1vY2tJbXBsZW1lbnRhdGlvbihvcmlnaW5hbC5yZWFkRmlsZVN5bmMpO1xuICAgIGplc3Quc3B5T24oZnMsICd3cml0ZUZpbGVTeW5jJykubW9ja0ltcGxlbWVudGF0aW9uKG9yaWdpbmFsLndyaXRlRmlsZVN5bmMpO1xuICAgIGplc3Quc3B5T24oZnMsICdta2RpclN5bmMnKS5tb2NrSW1wbGVtZW50YXRpb24ob3JpZ2luYWwubWtkaXJTeW5jKTtcbiAgICBqZXN0LnNweU9uKGZzLCAncm1TeW5jJykubW9ja0ltcGxlbWVudGF0aW9uKG9yaWdpbmFsLnJtU3luYyk7XG4gIH07XG5cbiAgLy8gRm9uY3Rpb24gcG91ciBhY2PDqWRlciBhdSBzeXN0w6htZSBkZSBmaWNoaWVycyB2aXJ0dWVsXG4gIGNvbnN0IGdldFZpcnR1YWxGcyA9ICgpID0+IHZpcnR1YWxGcztcblxuICByZXR1cm4geyBmcywgcmVzdG9yZSwgZ2V0VmlydHVhbEZzIH07XG59ICJdLCJ2ZXJzaW9uIjozfQ==